---
title: "데이터시각화 1 - EDA"
author: "YOU!"
date: '2020 6 6 '
output: 
  ioslides_presentation: 
    css: scrollable_slides.css
    keep_md: yes
    smaller: yes
    widescreen: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

### extrafont 사용하기 : true type font(.ttf)만 지원 
#install.packages('extrafont')
# library(extrafont)
# font_import(pattern = 'D2')
# font_import(pattern = 'NanumGothic')
# loadfonts()
# fonttable() # 설치된 font 확인
```
# **일변량 범주형 데이터의 탐색**  
## 5-1 도수분포표의 작성 {.build}
```{r}
favorite <- c('WINTER', 'SUMMER', 'SPRING', 'SUMMER', 'SUMMER',
              'FALL', 'FALL', 'SUMMER', 'SPRING', 'SPRING')
favorite                                # favorite의 내용 출력
table(favorite)                         # 도수분포표 계산
table(favorite)/length(favorite)        # 비율 출력
```

## 5-2 막대그래프의 작성 {.build}
```{r}
ds <- table(favorite)
ds                
barplot(ds, main='favorite season')
```

## 5-3 원그래프의 작성 {.build}
```{r}
ds <- table(favorite)
ds                
pie(ds, main='favorite season')
```

## 5-4 숫자로 표현된 범주형 데이터 {.build}
```{r}
favorite.color <- c(2, 3, 2, 1, 1, 2, 2, 1, 3, 2, 1, 3, 2, 1, 2)
ds <- table(favorite.color)
ds
barplot(ds, main='favorite color')
colors <- c('green', 'red', 'blue')
names(ds) <- colors                             # 자료값 1,2,3을 green, red, blue로 변경
ds
barplot(ds, main='favorite color', col=colors)  # 색 지정 막대그래프
pie(ds, main='favorite color', col=colors)      # 색 지정 원그래프
```

# **일변량 수치형 데이터의 탐색** 
## 5-5 평균과 중앙값 {.build}
```{r}
weight <- c(60, 62, 64, 65, 68, 69)
weight.heavy <- c(weight, 120)
weight
weight.heavy

mean(weight)                  # 평균
mean(weight.heavy)            # 평균

median(weight)                # 중앙값
median(weight.heavy)          # 중앙값

mean(weight, trim=0.2)        # 절사평균(상하위 20% 제외)
mean(weight.heavy,trim=0.2)   # 절사평균(상하위 20% 제외)
```

## 5-6 사분위수(quartile) 
```{r}
mydata <- c(60, 62, 64, 65, 68, 69, 120)
quantile(mydata)              # default로 3개 cut points생성  4개구간(사분위수,quartile)생성 
quantile(mydata, (0:10)/10)   # [0,1]구간 확률벡터를 인자로, 즉 10%단위로  구간 나눔   
summary(mydata)
```

## 5-7 분포(Distribution) : 분산, 표준편차, Range
```{r}
mydata <- c(60, 62, 64, 65, 68, 69, 120)
var(mydata)           # 분산
sd(mydata)            # 표준편차
range(mydata)         # 값의 범위
diff(range(mydata))   # 최댓값, 최솟값의 차이
```

## 5-8 히스토그램 
```{r}
dist <- cars[,2]                        # 자동차 제동거리
hist(dist,                              # 자료(data)
     main="Histogram for dist",         # 제목
     xlab ="dist",                      # x축 레이블 -제동거리
     ylab="count",                      # y축 레이블 -빈도수
     border="blue",                     # 막대 테두리색
     col="green",                       # 막대 색
     las=2,                             # 축의 tick label 글씨 방향(0~3)
     breaks=5)                          # 5개 break points, 6개 막대 
```

## 5-9 상자그림(box plot) 
```{r}
dist <- cars[,2]                        # 자동차 제동거리(단위: 피트)
boxplot(dist, main="dist")              # 자동차 제동거리 
```

## 5-10 boxplot.stats()에 의한 상세 내용 확인
```{r}
boxplot.stats(dist)
```

## 5-11 그룹이 있는 데이터에 대한 상자그림 
```{r}
boxplot(Petal.Length~Species, data=iris, main="Petal.Length by Species") # 품종별 꽃잎의 길이
```

## 5-12 한 화면에 그래프 여러개 그리기 {
```{r}
par(mfrow=c(1,3))
barplot(table(mtcars$carb), 
        main="Barplot of Carburetors",
        xlab="#of carburetors",  
        ylab="frequency",
        col="blue")
barplot(table(mtcars$cyl), 
        main="Barplot of Cylender",
        xlab="#of cylender",  
        ylab="frequency",
        col="red")
barplot(table(mtcars$gear), 
        main="Barplot of Grar",
        xlab="#of gears",  
        ylab="frequency",
        col="green")
par(mfrow=c(1,1))
```

# **다중 변수 데이터의 탐색** 
## 6-1 두 변수 사이의 산점도
```{r}
wt <-mtcars$wt                   # 중량 자료
mpg <- mtcars$mpg                # 연비 자료
plot(wt, mpg,                    # 2개 변수(x축, y축)     
     main="wt vs MPG",           # 제목 - 중량-연비 그래프
     xlab="wt",                  # x축 레이블- 중량(wt)
     ylab="MPG",                 # y축 레이블- 연비(MPG)
     col="red",                  # point의 color
     pch=19)                     # point의 종류 
```

## 6-2 여러 변수들 간의 산점도 
```{r}
vars <- c("mpg","disp","drat","wt")    # 대상 변수 
target <- mtcars[,vars]
head(target)
pairs(target,                          # 대상 데이터     
      main="Multi Plots") 
plot(target, main="Multi Plots")       # 위와 동일한 결과 
```

## 6-3 그룹 정보가 있는 두 변수의 산점도 
```{r}
iris.2 <- iris[,3:4]                # 데이터 준비
point <- as.numeric(iris$Species)   # 점의 모양
point                               # point 내용 출력
color <- c("red","green","blue")    # 점의 컬러
plot(iris.2, 
     main="Iris plot",
     pch=c(point),
     col=color[point]) 
```

## 6-4 R을 이용한 상관계수의 계산 
```{r}
beers = c(5,2,9,8,3,7,3,5,3,5)                 # 자료 입력
bal <- c(0.1,0.03,0.19,0.12,0.04,0.0095,0.07,  # 자료 입력
         0.06,0.02,0.05)
tbl <- data.frame(beers,bal)                   # 데이터프레임 생성
tbl                                
plot(bal~beers,data=tbl)                       # 산점도 
res <- lm(bal~beers,data=tbl)                  # 회귀식 도출
abline(res)                                    # 회귀선 그리기
cor(beers,bal)                                 # 상관계수 계산
```

## 6-5 4개 변수간 상관성 분석
```{r}
cor(iris[,1:4])                   # 4개 변수 간 상관성 분석
```

## 6-6 선그래프의 작성 
```{r}
month = 1:12                             # 자료 입력
late  = c(5,8,7,9,4,6,12,13,8,6,6,4)     # 자료 입력      
plot(month,                              # x data
     late,                               # y data
     main="Late cnt trend over time",    # 제목 - 지각생 통계
     type= "l",                          # 그래프의 종류 선택(알파벳) 
     lty=1,                              # 선의 종류(line type) 선택
     lwd=1,                              # 선의 굵기 선택
     xlab="Month",                       # x축 레이블
     ylab="Late cnt"                     # y축 레이블
)
```

## 6-7 복수의 선그래프 작성 
```{r}
month = 1:12
late1  = c(5,8,7,9,4,6,12,13,8,6,6,4)
late2  = c(4,6,5,8,7,8,10,11,6,5,7,3)
plot(month,                                # x data
     late1,                                # y data
     main="Late Students",
     type= "b",                            # 그래프의 종류 선택(알파벳) 
     lty=1,                                # 선의 종류(line type) 선택
     col="red",                            # 선의 색깔 선택          
     xlab="Month ",                        # x축 레이블
     ylab="Late cnt",                      # y축 레이블
     ylim=c(1, 15)                         # y축 값의 (하한, 상한)
)
lines(month,                               # x data
      late2,                               # y data
      type = "b",                          # 선의 종류(line type) 선택
      col = "blue")                        # 선의 색깔 선택
```

# **탐색적 데이터 분석 과정(6-8)** 
## (1) 분석 대상 데이터셋 준비 
```{r}
#install.packages("mlbench")
library(mlbench)
data("BostonHousing")
myds <- BostonHousing[,c("crim","rm","dis","tax","medv")]
```

## (2) grp 변수 추가  
```{r}
grp <- c()
for (i in 1:nrow(myds)) {                   # myds$medv 값에 따라 그룹 분류
  if (myds$medv[i] >= 25.0) {
    grp[i] <- "H"
  } else if (myds$medv[i] <= 17.0) {
    grp[i] <- "L"
  } else {
    grp[i] <- "M"
  }
}
grp <- factor(grp)                          # 문자벡터를 팩터 타입으로 변경
grp <- factor(grp, levels=c("H","M","L"))   # 레벨의 순서를 H,L,M -> H,M,L

myds <- data.frame(myds, grp)               # myds 에 grp 컬럼추가
```

## (3) 데이터셋의 형태와 기본적인 내용 파악  
```{r}
str(myds)  
head(myds)
table(myds$grp)                             # 주택 가격 그룹별 분포
```

## (4) 히스토그램에 의한 관측값의 분포 확인 
```{r}
par(mfrow=c(2,3))                           # 2x3 가상화면 분할
for(i in 1:5) {
  hist(myds[,i], main=colnames(myds)[i], col="yellow")
}
par(mfrow=c(1,1))                           # 2x3 가상화면 분할 해제
```

## (5) 상자그림에 의한 관측값의 분포 확인 
```{r}
par(mfrow=c(2,3))                           # 2x3 가상화면 분할
for(i in 1:5) {
  boxplot(myds[,i], main=colnames(myds)[i])
}
par(mfrow=c(1,1))                           # 2x3 가상화면 분할 해제
```

## (6) 그룹별 관측값 분포의 확인 
```{r}
boxplot(myds$crim~myds$grp, main="crim")  # 1인당 범죄율
boxplot(myds$rm~myds$grp, main="rm")      # 방의 수 
boxplot(myds$dis~myds$grp, main="dis")    # 직업센터까지의 거리
boxplot(myds$tax~myds$grp, main="tax")    # 재산세 
```

## (7) 다중 산점도를 통한 변수간 상관 관계의 확인 
```{r}
pairs(myds[,-6])
```

## (8) 그룹 정보를 포함한 변수간 상관 관계의 확인  
```{r}
point <- as.integer(myds$grp)                 # 점의 모양 지정
color <- c("red","green","blue")              # 점의 색 지정   
pairs(myds[,-6], pch=point, col=color[point])
```

## (9) 변수간 상관관계(correlation coefficient)의 확인 
```{r}
cor(myds[,-6])
```
